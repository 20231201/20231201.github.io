---
title: 前后端连接与php基础
---

# 前后端连接与php基础

​      December 12, 2023            57694    

## PHP基础语法

```
<?php
// $b = "1";
// $a = "1.0";
// $s=$a.$s."bbb";//变量与变量之间用点连接
// echo $s;
// if($a ===$b){   //==弱类型匹配，只匹配值，不匹配类型,===是强类型
//   echo 1;
//   echo $a;
// }else{
//   echo 2;
// }
// $a=$_GET['a'];//可以从浏览器输入数据
// echo $a;
```

### for循环例题

假设在笼子里有头数为8的动物，总共有22只脚。

  `$a=2;`

  `$b=4;`

```
for ($i = 0; $i < 8; $i++) {
```

  `if($a*$i+$b*(8-$i)==22){`

​    `$p=8-$i;`

​    `echo '鸡='.$i.PHP_EOL,'兔='.$p;`

  `}`

```
}
```

n张5毛，y张1块，z张10块，t张50，x张100，问我手上一共有156钱，一共有多少种组合，满足我手上的钱

  `function countCombinations($n, $y, $z, $t, $x, $total) {`  

​    `$combinations = 0;`  

``     

​    `// 遍历每种面额的组合数量`  

​    `for ($i = 0; $i <= $n; $i++) {`  

​      `for ($j = 0; $j <= $y; $j++) {`  

​        `for ($k = 0; $k <= $z; $k++) {`  

​          `for ($l = 0; $l <= $t; $l++) {`  

​            `for ($m = 0; $m <= $x; $m++) {`  

​              `// 计算当前组合的总金额`  

​              `$currentTotal = $i * 0.5 + $j * 1 + $k * 10 + $l * 50 + $m * 100;`  

``               

​              `// 如果当前组合的总金额等于给定总金额，则增加组合数量`  

​              `if ($currentTotal === $total) {`  

​                `$combinations++;`  

​              `}`  

​            `}`  

​          `}`  

​        `}`  

​      `}`  

​    `}`  

``     

​    `return $combinations;`  

  `}`  

``   

  `// 给定总金额和每种面额的数量`  

  `$total = 156;`  

  `$n = 5; // 5毛的数量`  

  `$y = 3; // 1块的数量`  

  `$z = 2; // 10块的数量`  

  `$t = 0; // 50的数量`  

  `$x = 1; // 100的数量`  

  `// 调用函数计算组合数量`  

  `$combinations = countCombinations($n, $y, $z, $t, $x, $total);`  

  `echo "满足条件的组合数量为：$combinations";`  

```
?>
```

## 前后端连接

下载并安装phpstudy_pro与navicat

### 在phpstudy_pro中设置为：

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)启动apache与MySQL

并在数据库bin目录下设置：

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)数据库设置

### 打开navicat，连接：

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)连接数据库

在连接的数据库中新建security数据库，并新建查询输入如下代码：

```
/*
 Navicat Premium Data Transfer

 Source Server         : 1
 Source Server Type    : MySQL
 Source Server Version : 50741
 Source Host           : localhost:3306
 Source Schema         : security

 Target Server Type    : MySQL
 Target Server Version : 50741
 File Encoding         : 65001

 Date: 12/12/2023 15:44:36
*/

SET NAMES utf8mb4;
SET FOREIGN_KEY_CHECKS = 0;

-- ----------------------------
-- Table structure for emails
-- ----------------------------
DROP TABLE IF EXISTS `emails`;
CREATE TABLE `emails`  (
  `id` int(3) NOT NULL AUTO_INCREMENT,
  `email_id` varchar(30) CHARACTER SET gbk COLLATE gbk_chinese_ci NOT NULL,
  PRIMARY KEY (`id`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 9 CHARACTER SET = gbk COLLATE = gbk_chinese_ci ROW_FORMAT = Dynamic;

-- ----------------------------
-- Records of emails
-- ----------------------------
INSERT INTO `emails` VALUES (1, 'Dumb@dhakkan.com');
INSERT INTO `emails` VALUES (2, 'Angel@iloveu.com');
INSERT INTO `emails` VALUES (3, 'Dummy@dhakkan.local');
INSERT INTO `emails` VALUES (4, 'secure@dhakkan.local');
INSERT INTO `emails` VALUES (5, 'stupid@dhakkan.local');
INSERT INTO `emails` VALUES (6, 'superman@dhakkan.local');
INSERT INTO `emails` VALUES (7, 'batman@dhakkan.local');
INSERT INTO `emails` VALUES (8, 'admin@dhakkan.com');

-- ----------------------------
-- Table structure for referers
-- ----------------------------
DROP TABLE IF EXISTS `referers`;
CREATE TABLE `referers`  (
  `id` int(3) NOT NULL AUTO_INCREMENT,
  `referer` varchar(256) CHARACTER SET gbk COLLATE gbk_chinese_ci NOT NULL,
  `ip_address` varchar(35) CHARACTER SET gbk COLLATE gbk_chinese_ci NOT NULL,
  PRIMARY KEY (`id`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 1 CHARACTER SET = gbk COLLATE = gbk_chinese_ci ROW_FORMAT = Dynamic;

-- ----------------------------
-- Table structure for uagents
-- ----------------------------
DROP TABLE IF EXISTS `uagents`;
CREATE TABLE `uagents`  (
  `id` int(3) NOT NULL AUTO_INCREMENT,
  `uagent` varchar(256) CHARACTER SET gbk COLLATE gbk_chinese_ci NOT NULL,
  `ip_address` varchar(35) CHARACTER SET gbk COLLATE gbk_chinese_ci NOT NULL,
  `username` varchar(20) CHARACTER SET gbk COLLATE gbk_chinese_ci NOT NULL,
  PRIMARY KEY (`id`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 1 CHARACTER SET = gbk COLLATE = gbk_chinese_ci ROW_FORMAT = Dynamic;

-- ----------------------------
-- Table structure for users
-- ----------------------------
DROP TABLE IF EXISTS `users`;
CREATE TABLE `users`  (
  `id` int(3) NOT NULL AUTO_INCREMENT,
  `username` varchar(20) CHARACTER SET gbk COLLATE gbk_chinese_ci NOT NULL,
  `password` varchar(20) CHARACTER SET gbk COLLATE gbk_chinese_ci NOT NULL,
  PRIMARY KEY (`id`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 15 CHARACTER SET = gbk COLLATE = gbk_chinese_ci ROW_FORMAT = Dynamic;

-- ----------------------------
-- Records of users
-- ----------------------------
INSERT INTO `users` VALUES (1, 'Dumb', 'Dumb');
INSERT INTO `users` VALUES (2, 'Angelina', 'I-kill-you');
INSERT INTO `users` VALUES (3, 'Dummy', 'p@ssword');
INSERT INTO `users` VALUES (4, 'secure', 'crappy');
INSERT INTO `users` VALUES (5, 'stupid', 'stupidity');
INSERT INTO `users` VALUES (6, 'superman', 'genious');
INSERT INTO `users` VALUES (7, 'batman', 'mob!le');
INSERT INTO `users` VALUES (8, 'admin', 'admin');
INSERT INTO `users` VALUES (9, 'admin1', 'admin1');
INSERT INTO `users` VALUES (10, 'admin2', 'admin2');
INSERT INTO `users` VALUES (11, 'admin3', 'admin3');
INSERT INTO `users` VALUES (12, 'dhakkan', 'dumbo');
INSERT INTO `users` VALUES (14, 'admin4', 'admin4');

SET FOREIGN_KEY_CHECKS = 1;
```

此时可见该数据库中添加了四张表格。

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)navicat数据库表格

### 打开vscode，

在phpstudy_pro的www目录下新建index.php与link.php文件

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)index与link

```
//link.php
<?php
header('content-type: text/html; charset=utf-8');
 if(isset($_POST['submit'])){
     $u = trim($_POST['username']);
     $p = trim($_POST['password']);
    $link=mysqli_connect("127.0.0.1","root","root","security")or exit("Error connecting");
      mysqli_query($link,"set names utf8");
  $sql=  "select * from users where username='$u' and password='$p'";
  $result=mysqli_query($link, $sql) ;
   $row=mysqli_fetch_array($result) ;
 if($row){
   echo "<font size='5' color= '#99FF00'>";
   echo 'Your Login name:'. $row['username']."<br>";
   echo 'Your Password:' .$row['password'];
   echo "</font>";
 }
}
?>
index.php
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Document</title>
</head>
<body>
 
<form method="post" action="link.php">
<tr><td>用户名: </td><td><input type="text" name="username"></td></tr>
<br>
<tr><td>密码:</td><td><input type="password" name="password"></td></tr>
<td><input type="checkbox" name="remeber" value="yes">记住密码</td><br>
<td>
<input type="submit" name="submit" value="提交">
</td>
<td><input type="reset" value="重置"></td>
</form>
 
</body>
</html>
```

测试运行检查是否连接到数据库，在输入正确的用户名与密码后正常登入。

### 完善页面

```
link.php
<?php
header('content-type: text/html; charset=utf-8');
session_start();

if(isset($_POST['submit'])){
    $u = trim($_POST['username']);
    $p = trim($_POST['password']);
 $link=mysqli_connect("127.0.0.1","root","root","security")or exit("Error connecting");
      mysqli_query($link,"set names utf8");
  $sql=  "select * from users where username='$u' and password='$p'";
  $result=mysqli_query($link, $sql) ;
  if(mysqli_num_rows($result)>=1){
        $_SESSION['user']=$u;       
        setcookie('password',$p,time()+7*12*60*60);
        header('Location:zhuye.php');
        exit();
    }else{
        echo "<br>";
        echo '用户名或密码错误!请重新输入!';
		//sleep(3);
		echo '<h1><a href="./index.php">返回</a></h1>';
        }
}


?>
zhuye.php
<?php
session_start();
include("./comment.php");
include("./upload.php");
header('Content-Type: text/html; charset=utf-8');

if(isset($_SESSION['user'])){
	echo '当前登录用户:'.$_SESSION['user'].''; 
	


if (isset($_GET['logout'])) {
    // 清除会话数据
    session_unset();
    session_destroy();
    echo "您已成功注销。<br>";
	header('Location:index.php');
}


echo '<h1><a href="?logout=true">注销</a></h1>';


}else{
echo '错误!';
header('Location:index.php');
}
?>
upload.php
<?php
echo '
<form action="" method="post" enctype="multipart/form-data">
<label for="upload">上传你的头像</label>
<input name="file" id="upload" type="file" >
<label for="submit"  >文件上传</label>
<input name="submit" id="submit" type="submit">
<h1>下面是接收到的文件</h1>
</form>
';
header('Content-Type: text/html; charset=utf-8');
if(isset($_FILES["file"])){
    $upload_dir = "uploads";
    $file_name = $_FILES["file"]["name"];
    $file_type = $_FILES["file"]["type"];
    $file_size = $_FILES["file"]["size"];
    $file_tmp = $_FILES["file"]["tmp_name"];
    $target_path = $upload_dir.'/'.$file_name;
    if (move_uploaded_file($file_tmp, $target_path)){
        echo "上传成功"."<br>";
        echo "文件类型: " . $file_type . "<br>";
        echo "文件大小: " . ($file_size / 1024) . " kB<br>";
        echo "文件存储的位置: " . $target_path;
    }else{
        echo "上传失败"."<br>";
    }
	echo "<br/>";
echo "<img src='./$target_path.'>";
}
?>
comment.php
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <form method="post" action="">
        <label for="comment">发表评论</label><br />
        <textarea name="comment" id="comment" rows="10" cols="80"></textarea><br />
        <input type="submit" name="submit" value="提交评论">
    </form>
    <h1>历史评论</h1>
    <?php
    if ($_SERVER['REQUEST_METHOD'] == 'POST') {
        if (isset($_POST['comment']) && !empty($_POST['comment'])) {
            $comment = $_POST['comment'];
            $link = mysqli_connect("localhost", "root", "root", "security") or exit("数据库连接失败！");
            mysqli_query($link, "set names utf8");
            $ChaRu = "insert INTO comments (comment) VALUES('$comment')";
            if (mysqli_query($link, $ChaRu)) {
                echo "<p>你的评论已成功保存到数据库。</p>";
            } else {
                echo "<p style='color: red;'>保存评论时出错。</p>";
            }
            mysqli_close($link);
        }
    }
    // 显示最近的20条评论
    $link = mysqli_connect("localhost", "root", "root", "security") or exit("数据库连接失败！");
    mysqli_query($link, "set names utf8");

    $query = "SELECT * FROM comments ORDER BY id DESC LIMIT 20";    
    $result = mysqli_query($link, $query);

    if ($result) {
        echo "<h2>最近的评论</h2>";
        while ($row = mysqli_fetch_assoc($result)) {
            echo "<p>{$row['comment']}</p>";
        }
    } else {
        echo "<p style='color: red;'>获取评论时出错。</p>";
    }

    mysqli_close($link);
    ?>
</body>
</html>
```

同时在navicat的security数据库中新建表：comments，包含id和comment两个字段。

comment：

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)评论

upload

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)提交文件

## php进阶

### 图书借阅网站

```
index.php
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="./index.css">
    <script src="./vue.js"></script>
    <style>
        body {  
            background-image: url("upload/屏幕截图\ 2023-12-15\ 143710.png");  
            background-repeat: no-repeat;  
            background-size: cover;  
        }  
    </style>
</head>

<body>

    <div id="app">
        <div class="login1">
            <div class="login2">
                <i class="el-icon-user"></i>
                <h1>登录</h1>
                <el-input placeholder="请输入内容" v-model="userData.username" clearable></el-input>
                <el-input placeholder="请输入内容" v-model="userData.password" clearable show-password></el-input>
                <el-button type="primary" @click="login">登录</el-button>
            </div>
        </div>
    </div>
    <style>
        .el-icon-user {
            font-size: 100px;
        }

        .login2 {
            text-align: center;
            justify-content: center;
            height: 20vh;
            width: 20vw;
        }

        .login1 {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
    </style>
    <script src="./axios.min.js"></script>
    <script src="./index.js"></script>
    <script>
        new Vue({
            el: '#app',
            data: function() {
                return {
                    visible: false,
                    userData: {
                        username: '',
                        password: '',
                    }
                }
            },
            methods: {
                login: function() {
        if (this.userData.username === 'admin') {
            var username = this.userData.username;
            window.location.href = 'http://192.168.2.60/home.php?username=' + username;
        } else {
            axios.post('http://192.168.2.60/api.php', {
    username: this.userData.username,
    password: this.userData.password
})
.then((response) => {
    console.log('Received response:', response);
    // ... 其他处理逻辑
})
.catch((error) => {
    console.error('Error occurred:', error);
    // ... 其他处理逻辑
});
        }
    },
    open4: function() {
        this.$notify.error({
            title: '错误',
            message: '账号密码错误'
        });
    }
            }
        })
    </script>
</body>

</html>
api.php
<?php
// 首先获取POST请求中的用户名和密码
$username = $_POST['username'];
$password = $_POST['password'];

$link = mysqli_connect("127.0.0.1", "root", "root", "security") or exit("Error connecting");
mysqli_query($link, "set names utf8");

$stmt = mysqli_prepare($link, "SELECT * FROM users WHERE username=? AND password=?");
mysqli_stmt_bind_param($stmt, "ss", $username, $password);
mysqli_stmt_execute($stmt);
$result = mysqli_stmt_get_result($stmt);

if ($row = mysqli_fetch_assoc($result)) {
    // 登录成功，输出JSON格式的响应
    echo json_encode(array("status" => "success"));
} else {
    // 登录失败，输出JSON格式的响应
    echo json_encode(array("status" => "fail"));
}

mysqli_stmt_close($stmt);
mysqli_close($link);
?>
home.php
<?php
header('Access-Control-Allow-Origin: *'); // 或者指定允许的域
header('Access-Control-Allow-Methods: POST, GET, OPTIONS');
header('Access-Control-Allow-Headers: Content-Type');
session_start();
header('Content-Type: text/html; charset=utf-8');

// 连接到数据库  
$link = mysqli_connect("127.0.0.1", "root", "root", "security") or exit("Error connecting");
mysqli_query($link, "set names utf8");
if (isset($_GET['username'])) {
    echo '当前登录用户:' . $_GET['username'] . '';
    $user = $_GET['username'];
    if (isset($_GET['logout'])) {
        // 清除会话数据  
        session_unset();
        session_destroy();
        echo "您已成功注销。<br>";
        header('Location:index.php');
        exit; // 确保在注销后退出脚本  
    }
    echo '<h1><a href="?logout=true">注销</a></h1>';

    // 使用预处理语句进行SQL查询  
    $stmt = mysqli_prepare($link, "SELECT id FROM users WHERE username = ?");
    mysqli_stmt_bind_param($stmt, "s", $user);
    mysqli_stmt_execute($stmt);
    $result = mysqli_stmt_get_result($stmt);
    if ($result && mysqli_num_rows($result) > 0) {
        // 获取查询结果并输出或进行其他处理  
        $row = mysqli_fetch_assoc($result);
        echo "用户ID: " . $row['id'] . "<br>";
    } else {
        echo "没有找到用户ID";
    }
    // 释放结果和关闭预处理语句  
    mysqli_stmt_close($stmt);
    mysqli_free_result($result);
} else {
    echo '错误!';
    header('Location:index.php');
}
?>
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>index</title>
    <link rel="stylesheet" href="./index.css">

    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f0f0;
        }

        .container {
            width: 960px;
            margin: 0 auto;
            background-color: #fff;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        header {
            text-align: center;
            padding: 10px 0;
            background-color: #333;
            color: #fff;
        }

        nav {
            background-color: #555;
            color: #fff;
        }

        nav a {
            color: #fff;
            text-decoration: none;
            margin: 0 10px;
        }

        section {
            padding: 20px 0;
        }

        footer {
            text-align: center;
            padding: 10px 0;
            background-color: #333;
            color: #fff;
        }

        .back-to-top {
            background-color: red;
            color: white;
            width: 100px;
            height: 100px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>图书馆管理系统</h1>
        </header>
        <nav>
            <button class="scroll-button" onclick="scrollToElement('tushu')">图书管理</button> | <button class="scroll-button" onclick="scrollToElement('yonghu')">用户管理</button> | <button class="scroll-button" onclick="scrollToElement('jieyue')">用户借阅管理</button>
        </nav>
        <section>
            <h2 id="tushu">图书列表</h2>
            <p><?php
                $query = "SELECT * FROM 图书管理 limit 10";
                $result = mysqli_query($link, $query);
                if ($result) {
                    echo "<h2>图书：</h2>";
                    while ($row = mysqli_fetch_assoc($result)) {
                        foreach ($row as $column => $value) {
                            echo "{$column}: {$value}<br>";
                        }
                    }
                } else {
                    echo "<p style='color: red;'>获取图书时出错。</p>";
                }
                if ($_GET['username'] == 'admin') {
                    // 跳转到另一个页面  
                    echo '<a href="tushuxiugai.php">当前为管理员账号，可编辑图书</a>';
                } else {
                        echo "<p style='color: red;'>当前为非管理员账号，无法编辑图书，仅可查找</p>";
                        echo "<form action='chazhao.php' method='post'>";
                        echo "<label for='bookInput'>请输入要查找的图书名:</label><br>";
                        echo "<input type='text' id='bookInput' name='book'><br>";
                        echo "<input type='submit' name='submit2' value='提交'>";
                        echo "</form>"; 
                }
                ?>
                <br /><a href="xinxi.php">查看完整书单</a>
            <form action="jieyue.php" method="post">
                <?php
                // 输出当前用户的信息
                if (isset($_GET['username'])) {
                    $user = $_GET['username'];
                    $query = "SELECT id FROM users WHERE username = '$user'";
                    $result = mysqli_query($link, $query);
                    if ($result && mysqli_num_rows($result) > 0) {
                        $row = mysqli_fetch_assoc($result);
                        echo "用户ID: " . $row['id'] . "<br>";
                        // 添加表单
                        echo "<form action='jieyue.php' method='post'>";
                        echo "<input type='hidden' name='userId' value='" . $row['id'] . "'>";
                        echo "<label for='bookInput'>请输入要借阅的图书名：</label><br>";
                        echo "<input type='text' id='bookInput' name='book'><br>";
                        echo "<input type='submit' name='submit2' value='提交'>";
                        echo "</form>";
                    } else {
                        echo "没有找到用户ID";
                    }
                } else {
                    echo '错误!';
                    header('Location:index.php');
                }
                ?>
            </form>



        </section>
        <section>
            <h2 id="yonghu">用户列表</h2>
            <p><?php
                $query = "SELECT id,username FROM users ORDER BY id limit 10";
                $result = mysqli_query($link, $query);
                if ($result) {
                    echo "<h2>用户：</h2>";
                    while ($row = mysqli_fetch_assoc($result)) {
                        foreach ($row as $column => $value) {
                            echo "{$column}: {$value}<br>";
                        }
                    }
                } else {
                    echo "<p style='color: red;'>获取用户时出错。</p>";
                }
                if ($_GET['username'] == 'admin') {
                    // 跳转到另一个页面  
                    echo '<a href="yonghu1.php">当前为管理员账号，可编辑用户</a>';
                } else {
                    echo "<p style='color: red;'>当前为非管理员账号，无法编辑用户</p>";
                }
                ?></p>
        </section>
        <section>
            <h2 id="jieyue">用户借阅信息列表</h2>
            <p><?php
                $query = "SELECT * FROM 用户借阅管理 ORDER BY id DESC limit 10";
                $result = mysqli_query($link, $query);
                if ($result) {
                    echo "<h2>借阅信息：</h2>";
                    while ($row = mysqli_fetch_assoc($result)) {
                        foreach ($row as $column => $value) {
                            echo "{$column}: {$value}<br>";
                        }
                    }
                } else {
                    echo "<p style='color: red;'>获取借阅信息时出错。</p>";
                }
                if ($_GET['username'] == 'admin') {
                    // 跳转到另一个页面  
                    echo '<a href="yonghu1.php">当前为管理员账号，可编辑借阅信息</a>';
                } else {
                    echo "<p style='color: red;'>当前为非管理员账号，无法编辑借阅信息</p>";
                }
                mysqli_close($link);
                ?></p>
        </section>
        <footer>ls版权所有 &copy; 2023</footer>
    </div>
    <button class="back-to-top" onclick="window.scrollTo(0,0)">回到顶部</button>
    <script>
        function scrollToElement(elementId) {
            var element = document.getElementById(elementId);
            window.scrollTo(0, element.offsetTop);
        }
    </script>
</body>
</html>
chazhao.php
<?php
$u=trim($_POST["book"]);
$link=mysqli_connect("127.0.0.1","root","root","security");
mysqli_query($link,"set names utf8");
$query = "SELECT * FROM 图书管理 where 图书名 = '$u'";
$result = mysqli_query($link, $query);
if (mysqli_num_rows($result) > 0) {
    while ($row = mysqli_fetch_assoc($result)) {
        foreach ($row as $column => $value) {
            echo "{$column}: {$value}<br>";
        }
    }
} else {
    echo "<p style='color: red;'>图书库里未找到该书。</p>";
}
?>
<a href="1.php">点击返回主页</a>
jieyue.php
<?php
header('content-type: text/html; charset=utf-8');

$id = $_POST['userId']; 
if (isset($_POST['submit2'])) {
    $u = trim($_POST['book']);
    $p = $id;
    $link = mysqli_connect("127.0.0.1", "root", "root", "security") or exit("Error connecting");
    mysqli_query($link, "set names utf8");
    $sql = "select * from 图书管理 where 图书名 = '$u'";
    $result = mysqli_query($link, $sql);
    $row1 = mysqli_fetch_assoc($result);
    if($row1){//是否存在该书名
        $book_id = $row1['id'];  // 获取到图书对应的id
        $sql2 = "select username from users where id = '$p'";
        $result2 = mysqli_query($link, $sql2);
        $row2 = mysqli_fetch_assoc($result2);
        if($row2){//是否存在该借阅人
            $username = $row2['username'];  // 获取到借阅人的用户名
            $sql3 =  "INSERT INTO 用户借阅管理(借阅人username, 借阅图书id, 借阅人id, 借阅图书名) VALUES ('$username', '$book_id', '$p', '$u')";
            if (mysqli_query($link, $sql3)) {  
                echo "成功";  
            } else {  
                echo "错误: " . $link->error;  
            }
        } else {
            echo "未找到对应借阅人";
        }
    } else {
        echo "不存在该书名";
    }
    echo '<a href="1.php">点击返回首页</a>';
} else {
    echo "未提交表单";
}
?>
jieyuexinxi.php
<?php
header('content-type: text/html; charset=utf-8');
session_start();

if (isset($_POST['submit1'])) {
    $u = trim($_POST['id']);
    $p = trim($_POST['id1']);
    $q = trim($_POST['userid']);
    $h = trim($_POST['shanchu']);
    $s = trim($_POST['chaxun']);
    $link = mysqli_connect("127.0.0.1", "root", "root", "security") or exit("Error connecting");
    mysqli_query($link, "set names utf8");
    $sql="select * from users where username = '$u'";
    $result = mysqli_query($link, $sql);
    if($u==null and $p!=null and $q!=null){//是否存在该用户
    $sql =  "INSERT INTO users( username, password)  VALUES ( '$p', '$q');";
}elseif($h!=null){//删除
    $sql = "DELETE FROM users  
    WHERE username = '$h';";
}elseif($s!=null){//查询
    $sql = " select * from users where username = '$s'";
}elseif($q==null and $u==null and $p!=null){//未输入密码
    echo "请输入密码";
    $sql = "select * from users where username = '$q'";
}
else{//更新
    $sql = "UPDATE users SET username='$p' , password='$q' where username='$u'";
}

if (mysqli_query($link, $sql)) {  
    echo "成功";
} else {  
    echo "错误: " . $conn->error;  
}   
} else {
    echo "连接失败";
}
echo '<a href="1.php">点击返回主页</a>
';
?>
tushu.php
<?php
header('content-type: text/html; charset=utf-8');
session_start();

if (isset($_POST['submit1'])) {
    $u = trim($_POST['book']);
    $p = trim($_POST['book1']);
    $q = trim($_POST['zuozhe']);
    $h = trim($_POST['shanchu']);
    $s = trim($_POST['chaxun']);
    $link = mysqli_connect("127.0.0.1", "root", "root", "security") or exit("Error connecting");
    mysqli_query($link, "set names utf8");
    $sql="select * from 图书管理 where 图书名 = '$u'";
    $result = mysqli_query($link, $sql);
    if($u==null and $p!=null){//是否存在该书名
    $sql =  "INSERT INTO 图书管理( 图书名, 作者)  VALUES ( '$p', '$q');";
}elseif($h!=null){
    $sql = "DELETE FROM 图书管理  
    WHERE 图书名 = '$h';";
}elseif($s!=null){
    $sql = "select select * from 图书管理 where 图书名 = '$s'";
}elseif($q==null and $u==null and $p!=null){//未输入密码
    echo "请输入密码";
    $sql = "select * from 图书管理 where 图书名 = '$q'";
}else{
    $sql = "UPDATE 图书管理 SET 图书名='$p' , 作者='$q' where 图书名='$u'";
}

if (mysqli_query($link, $sql)) {  
    echo "成功";  
} else {  
    echo "错误: " . $conn->error;  
}   
} else {
    echo "连接失败";
}
echo '<a href="1.php">点击返回首页</a>
';
?>
tushuxiugai.php
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>用户管理</title>
    <style>  
        body {  
            background-image: url("upload/8fb7605db8918ba64c0794857cb5a64.jpg");  
            background-repeat: no-repeat;  
            background-size: cover;  
        }  
    </style> 
</head>
<body>
<form action="tushu.php" method="post">
                <label for="inputValue">请输入要修改的图书名(若要添加可不填)：</label><br>
                <input type="text" id="inputValue" name="book"><br>
                <label for="inputValue">请输入修改后的图书名：</label><br>
                <input type="text" id="inputValue" name="book1"><br>
                <label for="inputValue">请输入修改后的作者名：</label><br>
                <input type="text" id="inputValue" name="zuozhe"><br>
                <label for="inputValue">请输入要删除的书名：</label><br>
                <input type="text" id="inputValue" name="shanchu"><br>
                <label for="inputValue">请输入要查询的书名：</label><br>
                <input type="text" id="inputValue" name="chaxun"><br>
                <input type="submit" name="submit1" value="提交">
                <td><input type="reset" value="重置">
            </form>
            <a href="1.php">点击返回主页</a>
</body>
</html>
xinxi.php
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>图书信息</title>
    <style>
    body{
        background-image:url("upload/fba8bef1d709d7b45fae1bfc6e2f737.jpg");
    }
    .return{
        display: block;  
        text-align: center;
        font-size: 30px;
    }
    .wenzi{
        color:gold;
    }
    </style>
</head>
<body>
    <a href="1.php" class="return">点击返回主页</a>
    <div class="wenzi">
    <?php
$link=mysqli_connect("127.0.0.1","root","root","security");
mysqli_query($link,"set names utf8");
$query = "SELECT * FROM 图书管理";
$result = mysqli_query($link, $query);
if ($result) {
    echo "<h2>图书：</h2>";
    while ($row = mysqli_fetch_assoc($result)) {
        foreach ($row as $column => $value) {
            echo "{$column}: {$value}<br>";
        }
    }
} else {
    echo "<p style='color: red;'>获取图书时出错。</p>";
}
?></div>
</body>
</html>
yonghu.php
<?php
header('content-type: text/html; charset=utf-8');
session_start();

if (isset($_POST['submit1'])) {
    $u = trim($_POST['user']);
    $p = trim($_POST['user1']);
    $q = trim($_POST['mima']);
    $h = trim($_POST['shanchu']);
    $s = trim($_POST['chaxun']);
    $link = mysqli_connect("127.0.0.1", "root", "root", "security") or exit("Error connecting");
    mysqli_query($link, "set names utf8");
    $sql="select * from users where username = '$u'";
    $result = mysqli_query($link, $sql);
    if($u==null and $p!=null and $q!=null){//是否存在该用户
    $sql =  "INSERT INTO users( username, password)  VALUES ( '$p', '$q');";
}elseif($h!=null){//删除
    $sql = "DELETE FROM users  
    WHERE username = '$h';";
}elseif($s!=null){//查询
    $sql = " select * from users where username = '$s'";
}elseif($q==null and $u==null and $p!=null){//未输入密码
    echo "请输入密码";
    $sql = "select * from users where username = '$q'";
}
else{//更新
    $sql = "UPDATE users SET username='$p' , password='$q' where username='$u'";
}

if (mysqli_query($link, $sql)) {  
    echo "成功";
} else {  
    echo "错误: " . $conn->error;  
}   
} else {
    echo "连接失败";
}
echo '<a href="1.php">点击返回主页</a>
';
?>
yonghu1.php
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>用户管理</title>
    <style>  
        body {  
            background-image: url("upload/1d84875aea7e21783d8bad4240722a0.jpg");  
            background-repeat: no-repeat;  
            background-size: cover;  
        }  
    </style> 
</head>
<body>
<form action="yonghu.php" method="post">
                <label for="inputValue">请输入要修改的用户名(若要添加可不填):</label><br>
                <input type="text" id="inputValue" name="user"><br>
                <label for="inputValue">请输入修改后(添加)的用户：</label><br>
                <input type="text" id="inputValue" name="user1"><br>
                <label for="inputValue">请输入修改后的密码：</label><br>
                <input type="text" id="inputValue" name="mima"><br>
                <label for="inputValue">请输入要删除的用户名：</label><br>
                <input type="text" id="inputValue" name="shanchu"><br>
                <label for="inputValue">请输入要查询的用户名：</label><br>
                <input type="text" id="inputValue" name="chaxun"><br>
                <input type="submit" name="submit1" value="提交">
                <td><input type="reset"   value="重置" ><br>
            </form>
            <form action="jieyuexinxi.php" method="post">
                <label for="inputValue">请输入要修改的借阅信息id(若要添加可不填):</label><br>
                <input type="text" id="inputValue" name="id"><br>
                <label for="inputValue">请输入修改后(添加)的借阅信息id:</label><br>
                <input type="text" id="inputValue" name="id1"><br>
                <label for="inputValue">请输入修改后的借阅人id:</label><br>
                <input type="text" id="inputValue" name="userid"><br>
                <label for="inputValue">请输入要删除的借阅信息id:</label><br>
                <input type="text" id="inputValue" name="shanchu"><br>
                <label for="inputValue">请输入要查询的借阅信息id:</label><br>
                <input type="text" id="inputValue" name="chaxun"><br>
                <input type="submit" name="submit1" value="提交">
                <td><input type="reset"   value="重置" ><br>
            </form>
            <a href="1.php">点击返回主页</a>
</body>
</html>
yonghu2.php
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>用户管理</title>
    <style>  
        body {  
            background-image: url("upload/8c76d8c3bedbf543f743a4567d8be1e.jpg");  
            background-repeat: no-repeat;  
            background-size: cover;
            color: aliceblue;
        }  
    </style> 
</head>
<body>
<form action="yonghu.php" method="post">
                <label for="inputValue">请输入注册用户名：</label><br>
                <input type="text" id="inputValue" name="user1"><br>
                <label for="inputValue">请输入密码：</label><br>
                <input type="text" id="inputValue" name="mima"><br>
                <input type="submit" name="submit1" value="提交">
                <td><input type="reset"   value="重置" ><br>
                <a href="index.php">点击返回主页</a>
            </form>
</body>
</html>
```

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)postman

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)www文件夹

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)登录页

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)home.php

Admin用户登录会提示为管理员，点击可跳转编辑数据库内容。查看书单和借阅图书功能所有用户可使用。

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)img

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)img

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)img

借阅：

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)img

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)img

管理员用户的图书管理：

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)更改图书界面

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)更改图书

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)navicat数据库内容改动后

其余功能以此类推。

### 准备

项目文件夹

phpstudy_pro 小皮

element组件网页

Visual Studio Code

### 前端

新建index.php文件

html使用vue材料包

```
<!-- 引入Element UI样式 -->
<link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">

<!-- 引入Vue -->
<script src="https://unpkg.com/vue@2/dist/vue.js"></script>

<!-- 引入Element UI组件库 -->
<script src="https://unpkg.com/element-ui/lib/index.js"></script>

<!-- 引入axios -->
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<link rel="stylesheet" href="./index.css">
   <script src="./vue.js"></script>
   <script src="./index.js"></script>
   <script src="./axios.min.js"></script>
```

基本HTML结构的使用Vue和Element UI搭建的单页面应用骨架模板

```
<!DOCTYPE html>
<html lang="en">
<head>
  <title>数据交互</title>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="./index.css">
  <script src="./vue.js"></script>
  <script src="./axios.min.js"></script>
  <script src="./index.js"></script>
</head>
<body>
  <div id="app">
    <el-container>
      <!-- 这里直接写内容 -->
    </el-container>
  </div>

  <script>
    new Vue({
      el: '#app',
      data() {
        return {
          // 初始数据
        }
      },
      methods: {
        // 方法与函数调用
      },
      mounted() {
        // 组件挂载完毕后执行的代码
      }
    })
  </script>
</body>
</html>
```

插入需要的element组件

#### 数据绑定

click绑定点击事件

```
@click="router1()"
```

直接应用iframe元素内联样式来设置其位置和大小迅速进行样式的更改

```
<el-main>
	<iframe :src="iframeSrc" frameborder="false" style="top:80px;left: 120px;width: 97%;height: 520px"></iframe>
</el-main>
```

实现点击不同的事件改变页面

```
return {
	iframeSrc: ''
        }

methods: {
	router1() {
    this.iframeSrc = "root1.php"
    },      
    router2() {
    this.iframeSrc = "root2.php"
    }, 
    router3() {
    this.iframeSrc = "root3.php"
    }
}
```

#### 数据显示

使用`axios`发送一个GET请求到服务器的`名.php`文件，然后将响应数据赋值给Vue组件组件的`data`函数中声明的一个数据属性`数组`

```
mounted() {
	axios.get('名.php')
		.then(response => {
		this.数组 = response.data;
		})
}
mounted() {
   axios.get('名.php')
      .then(response => {
        this.数组 = response.data;
      })
      .catch(error => {
        console.error('在获取数据时发生错误:', error);
      });
}
```

后端数据返回

```
<?php
header('Content-Type: application/json;charset=utf-8');

$link = mysqli_connect("127.0.0.1", "root", "root", "security") or die("Error connecting");
mysqli_set_charset($link, "utf8");

$query = "SELECT a1, a2, a3, a4 FROM users";
$result = mysqli_query($link, $query);

$data = array();
while ($row = mysqli_fetch_assoc($result)) {
    $data[] = $row;
}

mysqli_close($link);

echo json_encode($data);
```

1. `header('Content-Type: application/json;charset=utf-8')`: 设置HTTP响应的内容类型为JSON，并指定字符集为UTF-8，以保证客户端如JavaScript能正确解析返回的数据。
2. `$link = mysqli_connect("127.0.0.1", "root", "root", "security")`: 使用`mysqli_connect`函数连接到本地的MySQL数据库服务器，此处使用默认的root用户和密码，并选中`security`数据库。`or die("Error connecting")`是错误处理，如果连接失败，将结束脚本并打印出”Error connecting”。
3. `mysqli_set_charset($link, "utf8")`: 设置数据库连接的字符集为UTF-8，这样传输的数据便能够正确处理国际字符。
4. `$query = "SELECT a1, a2, a3, a4 FROM users"`: 定义了一个SQL查询，该查询用于从`users`表中选取`a1`，`a2`，`a3`和`a4`四个字段。
5. `$result = mysqli_query($link, $query)`: 执行上面定义的查询。
6. 在`while`循环中，`mysqli_fetch_assoc($result)`被调用，它逐一取出每行结果，并将结果行作为关联数组返回。
7. 所有的行都被逐个添加到`$data`数组中。
8. 最后，`mysqli_close($link)`关闭了与数据库的连接。
9. `echo json_encode($data)`将所有的行编码为JSON格式，并打印输出，这样前端的JavaScript框架(如Vue.js)就可以通过HTTP请求来获取并处理数据。

#### 添加按钮

增加add，删除delete，修改edit

JavaScript 的严格模式下，delete不能使用，你需要将这个名称更改为非保留字的名称，比如deleteItem

通过scope-slot可以访问`scope`对象的属性，其中包括行数据 `scope.row`

```
<template slot-scope="scope">
	<el-button type="primary" @click="add(scope.row)">增加</el-button>
	<el-button type="success" @click="deleteItem(scope.row)">删除</el-button>
	<el-button type="info" @click="edit(scope.row)">修改</el-button>
</template>
```

事件触发

```
add(tableData) {},
delete(tableData) {},
edit(tableData) {}
```

对话框

```
<el-container>
         <el-dialog :visible.sync="dialogTableVisible" title="编辑用户">
             <el-form :model="editForm">
                 <el-form-item label="用户名" :label-width="formLabelWidth">
                     <el-input v-model="editForm.username"></el-input>
                 </el-form-item>
                 <el-form-item label="用户密码" :label-width="formLabelWidth">
                     <el-input v-model="editForm.password"></el-input>
                 </el-form-item>
             </el-form>
             <span slot="footer" class="dialog-footer">
                 <el-button @click="edit1 = false">取消</el-button>
                 <el-button type="primary" @click="submitEdit">提交</el-button>
             </span>
         </el-dialog>
     </el-container>
     <el-container>
         <el-dialog :visible.sync="dialogFormVisible" title="增加用户">
             <el-form :model="addForm">
                 <el-form-item label="用户名" :label-width="formLabelWidth">
                     <el-input v-model="addForm.username"></el-input>
                 </el-form-item>
                 <el-form-item label="用户密码" :label-width="formLabelWidth">
                     <el-input v-model="addForm.password"></el-input>
                 </el-form-item>
             </el-form>
             <span slot="footer" class="dialog-footer">
                 <el-button @click="add1 = false">取消</el-button>
                 <el-button type="primary" @click="submitAdd">提交</el-button>
             </span>
         </el-dialog>
     </el-container>
```

对editForm和addForm数组赋初值

```
editForm: {
                   id: '',
                   username: '',
                   password: ''
               },
               addForm: {
                   username: '',
                   password: ''
               },
```

对话框提交函数

发送 POST 请求至一个PHP 脚本，这个请求将包括一个动作action参数为 ‘delete’，以及users数组中的id

```
deleteItem() {
                axios.post('root111.php', {
                    	id: users.id
                        action: 'delete',
                    })
            },
```

动作action参数为 ‘add’与动作action参数为 ‘edit’，发送数组addForm与editForm的数据

```
submitAdd() {
                axios.post('root111.php', {
                    ...this.addForm,
                    action: 'add'
                })
            },
            submitEdit() {
                axios.post('root111.php', {
                    ...this.editForm,
                    action: 'edit'
                })
            },
```

### 后端

链接数据库

```
<?php
header('Content-Type: application/json;charset=UTF-8');

$link = mysqli_connect("127.0.0.1", "root", "root", "security") or die("Error connecting");
mysqli_set_charset($link, "utf8");

内容内容内容内容内容内容内容内容内容

mysqli_close($link);
```

接受请求

```
$input = json_decode(file_get_contents('php://input'), true);
```

处理请求

```
if ($input['action'] = 'delete') {
        mysqli_query($link, "DELETE FROM users WHERE id = {$input['id']}");
}
if ($input['action'] = 'add') {
        mysqli_query($link, "INSERT INTO users (username, password) VALUES ('{$input['username']}', '{$input['password']}')");
}
if ($input['action'] = 'edit') {
        mysqli_query($link, "UPDATE users SET username = '{$input['username']}', password = '{$input['password']}' WHERE id = {$input['id']}");
}
```

多个请求

```
$sql = match ($input['action']) {
    'delete' => "DELETE FROM users WHERE id = {$input['id']}",
    'add' => "INSERT INTO users (username, password) VALUES ('{$input['username']}', '{$input['password']}')",
    'edit' => "UPDATE users SET username = '{$input['username']}', password = '{$input['password']}' WHERE id = {$input['id']}"
};
```

switch使用

```
switch ($input['action']) {
    case 'delete':
        mysqli_query($link, "DELETE FROM users WHERE id = {$input['id']}");
        break;
    case 'add':
        mysqli_query($link, "INSERT INTO users (username, password) VALUES ('{$input['username']}', '{$input['password']}')");
        break;
    case 'edit':
        mysqli_query($link, "UPDATE users SET username = '{$input['username']}', password = '{$input['password']}' WHERE id = {$input['id']}");
        break;
}
```

数据检查

```
switch ($action) {
    case 'delete':
        $query = "DELETE FROM users WHERE id = ".$input['id'];
        $result['success'] = mysqli_query($link, $query);
        break;
    case 'add':
        $query = "INSERT INTO users (username, password) VALUES ('".$input['username']."', '".$input['password']."')";
        $result['success'] = mysqli_query($link, $query);
        break;
    case 'edit':
        $query = "UPDATE users SET username = '".$input['username']."', password = '".$input['password']."' WHERE id = ".$input['id'];
        $result['success'] = mysqli_query($link, $query);
        break;
}
if ($success) {
        echo json_encode(['success' => true]);
    } else {
        echo json_encode(['error' => true]);
    }
```

数据预处理

```
switch ($input['action']) {
    case 'delete':
        $stmt = mysqli_prepare($link, "DELETE FROM users WHERE id = ?");
        mysqli_stmt_bind_param($stmt, 'i', $input['id']);
        break;
    case 'add':
        $stmt = mysqli_prepare($link, "INSERT INTO users (username, password) VALUES (?, ?)");
        mysqli_stmt_bind_param($stmt, 'ss', $input['username'], $input['password']);
        break;
    case 'edit':
        $stmt = mysqli_prepare($link, "UPDATE users SET username = ?, password = ? WHERE id = ?");
        mysqli_stmt_bind_param($stmt, 'ssi', $input['username'], $input['password'], $input['id']);
        break;
    default:
        die(json_encode(['error' => "Invalid action"]));
}
```

布尔返回与语句释放

```
switch ($input['action']) {
    case 'delete':
        $stmt = mysqli_prepare($link, "DELETE FROM users WHERE id = ?");
        mysqli_stmt_bind_param($stmt, 'i', $input['id']);
        $success = mysqli_stmt_execute($stmt);
        mysqli_stmt_close($stmt);
        break;
    case 'add':
        $stmt = mysqli_prepare($link, "INSERT INTO users (username,password) VALUES (?, ?)");
        mysqli_stmt_bind_param($stmt, 'ss', $input['username'], $input['password']);
        $success = mysqli_stmt_execute($stmt);
        mysqli_stmt_close($stmt);
        break;
    case 'edit':
        $stmt = mysqli_prepare($link, "UPDATE users SET username = ?, password = ?WHERE id = ?");
        mysqli_stmt_bind_param($stmt, 'ssi', $input['username'], $input['password'], $input['id']);
        $success = mysqli_stmt_execute($stmt);
        mysqli_stmt_close($stmt);
        break;
    default:
        $success = false;
}

if ($success) {
    echo json_encode(['status' => 'success', 'message' => '成功']);
} else {
    echo json_encode(['status' => 'error', 'message' => '失败']);
}
```

- 